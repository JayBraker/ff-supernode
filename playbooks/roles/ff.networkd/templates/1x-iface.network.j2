[Match]
Name={{ item.iface }}

[Network]
{% if item.addresses is defined %}
{% for addr in item.addresses %}
Address={{ addr }}
{% endfor %}
{% endif %}
{% if item.gateway4 is defined %}
Gateway={{ item.gateway4 }}
{% endif %}
{% if item.gateway6 is defined %}
Gateway={{ item.gateway6 }}
{% endif %}
{% if item.dns_server is defined %}
{% for dns_server in item.dns_server %}
DNS={{ dns_server }}
{% endfor %}
{% endif %}
Domains={{ dns_searchdomains | default('.local') }}
{% if item.dhcp is defined and item.dhcp %}
DHCP=ipv4
{% endif %}
{% if item.no_radv_accept is defined and item.no_radv_accept %}
IPv6AcceptRouterAdvertisements=false
{% endif %}
{% if networkd_vlans is defined %}
{% for vlan in networkd_vlans %}
{% if vlan.iface == item.iface %}
VLAN=vlan{{ vlan.id }}
{% endif %}
{% endfor %}
{% endif %}
{% if 'supernodes' in group_names %}
{% for domain in domains | default( [] ) %}
VXLAN=vx-{{ domain.id }}-server
{% endfor %}
{% endif %}
{% if item.dhcp is defined and item.dhcp %}
[DHCPv4]
UseDNS=true
UseDomains=false
{% endif %}
{% if item.macaddress is defined %}
[Link]
MACAddress={{ item.macaddress }}
{% endif %}
{% for route in item.static_routes | default([]) %}
[Route]
{% if route.gw is defined %}
Gateway={{ route.gw }}
{% endif %}
Destination={{ route.dest }}
{% if route.src is defined %}
Source={{ route.src }}
{% endif %}
{% if route.metric is defined %}
Metric={{ route.metric }}
{% endif %}
{% if route.table is defined %}
Table={{ route.table }}
{% endif %}
{% if route.pref_src is defined %}
PreferredSource={{ route.pref_src }}
{% endif %}
{% endfor %}

{% if item.additional_config is defined -%}
{{ item.additional_config }}
{% endif %}

